<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"> -->
    <link rel="stylesheet" href="/static/css/flatpickr.min.css">
    <style>
    /* ==================== æ©Ÿå™¨åã”ã¨ã®ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ  ==================== */
    .device-row {
        transition: background-color 0.3s ease;
    }

    /* æŒ‡å®šåˆ—ã®æ–‡å­—è‰²ã‚’é»’ã«è¨­å®š */
    .data-table td:nth-child(1),  /* æ©Ÿå™¨å */
    .data-table td:nth-child(2),  /* æ’®å½±æ—¥æ™‚ */
    .data-table td:nth-child(3),  /* ã‚ªãƒ—ã‚·ãƒ§ãƒ³ */
    .data-table td:nth-child(6) { /* æ—¥ä»˜ */
        color: #000000;
    }

    /* ãƒ›ãƒãƒ¼æ™‚ã®è‰²èª¿æ•´ */
    .data-table tr:hover {
        filter: brightness(95%);
    }

    /* ==================== åˆ†é¡åˆ¥ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ  ==================== */
    .category-cell.type-äººç‰© { background-color: #FFEBEE; color: #B71C1C; }
    .category-cell.type-ãã®ä»– { background-color: #E8F5E9; color: #1B5E20; }
    .category-cell.type-èª¤æ¤œçŸ¥ { background-color: #E3F2FD; color: #0D47A1; }
    .category-cell.type-ã‚¨ãƒ©ãƒ¼ { background-color: #FFFDE7; color: #F57F17; }

    /* ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹åˆ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆä¿®æ­£ç‰ˆï¼‰ */
    .file-path-cell {
        font-family: monospace;
        font-size: 0.85em;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        cursor: pointer;
        background-color: #e8f5e9;  /* è–„ã„ç·‘è‰²ã®èƒŒæ™¯ */
        color: #1b5e20;             /* æ¿ƒã„ç·‘è‰²ã®æ–‡å­— */
        border-radius: 3px;
        padding: 8px !important;
        border: 1px solid #4caf50;  /* ç·‘è‰²ã®ãƒœãƒ¼ãƒ€ãƒ¼ */
        transition: all 0.3s ease;
        position: relative;         /* è¿½åŠ ï¼šç›¸å¯¾ä½ç½®æŒ‡å®š */
    }

    .file-path-cell:hover {
        background-color: #c8e6c9;  /* ãƒ›ãƒãƒ¼æ™‚ã¯ã‚ˆã‚Šæ¿ƒã„ç·‘ */
        color: #0d4b14;             /* ãƒ›ãƒãƒ¼æ™‚ã¯ã‚ˆã‚Šæ¿ƒã„ç·‘æ–‡å­— */
        transform: scale(1.02);
        z-index: 10;
        box-shadow: 0 2px 8px rgba(76,175,80,0.3);
    }

    /* ãƒ›ãƒãƒ¼æ™‚ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã‚¹ã‚¿ã‚¤ãƒ« */
    .file-path-cell::after {
        content: attr(data-full-path);
        position: absolute;
        left: 0;
        top: 100%;
        background-color: #f8f9fa;
        color: #495057;
        padding: 8px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        white-space: normal;
        word-break: break-all;
        max-width: 400px;
        z-index: 1000;
        display: none;
        font-size: 0.9em;
        border: 1px solid #dee2e6;
    }

    .file-path-cell:hover::after {
        display: block;
    }

    .file-path-cell::before {
        content: "ğŸ¬ ";  /* å‹•ç”»ã‚¢ã‚¤ã‚³ãƒ³ */
        margin-right: 3px;
    }

    /* çµ±è¨ˆæƒ…å ±ã‚¹ã‚¿ã‚¤ãƒ« */
    .stats-section {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border-left: 4px solid #007bff;
    }

    .stats-info {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .stat-item {
        background-color: white;
        padding: 10px 15px;
        border-radius: 5px;
        border: 1px solid #dee2e6;
        text-align: center;
        min-width: 120px;
    }

    .stat-item.oldest-item {
        background-color: #f6f6f6;
        border: 1.5px dashed #b0b0b0;
        color: #888;
        opacity: 0.85;
    }

    .stat-item.oldest-item .stat-value {
        color: #888;
        font-size: 1.2em;
    }

    .stat-item.oldest-item .stat-label {
        color: #888;
    }

    .stat-item.oldest-item .oldest-desc {
        font-size: 0.8em;
        color: #b0b0b0;
    }

    .stat-value {
        font-size: 1.5em;
        font-weight: bold;
        color: #007bff;
    }

    .stat-label {
        font-size: 0.9em;
        color: #6c757d;
    }

    /* ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒœã‚¿ãƒ³ */
    .refresh-btn {
        background-color: #17a2b8;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
        margin-left: 10px;
        transition: background-color 0.2s;
    }

    .refresh-btn:hover {
        background-color: #138496;
    }

    /* å‹•ç”»ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰ */
    .video-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.8);
        backdrop-filter: blur(5px);
    }

    .video-modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: none;
        border-radius: 12px;
        width: 90%;
        max-width: 1000px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        animation: modalSlideIn 0.3s ease-out;
    }

    .video-container {
        position: relative;
        width: 100%;
        background-color: #000;
        border-radius: 8px;
        overflow: hidden;
    }

    .video-player {
        width: 100%;
        height: auto;
        max-height: 70vh;
        background-color: #000;
    }

    .video-controls {
        margin-top: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }

    .video-info {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        color: #495057;
        word-break: break-all;
    }

    .video-close-btn {
        background: linear-gradient(45deg, #dc3545, #c82333);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
    }

    .video-close-btn:hover {
        background: linear-gradient(45deg, #c82333, #a71e2a);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(220,53,69,0.3);
    }

    .video-download-btn {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
    }

    .video-download-btn:hover {
        background: linear-gradient(45deg, #218838, #1ea68a);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(40,167,69,0.3);
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 8px;
        width: 80%;
        max-width: 600px;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 768px) {
        .video-modal-content {
            width: 95%;
            margin: 10% auto;
            padding: 15px;
        }

        .video-player {
            max-height: 50vh;
        }

        .video-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .video-controls button,
        .video-controls a {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }
    }

    .search-btn {
        margin-left: 18px;
        padding: 10px 28px;
        background: linear-gradient(45deg, #007bff, #00c6ff);
        color: #fff;
        border: none;
        border-radius: 5px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,123,255,0.08);
        transition: background 0.2s, transform 0.1s;
    }
    .search-btn:hover {
        background: linear-gradient(45deg, #0056b3, #00aaff);
        transform: translateY(-2px) scale(1.03);
    }
    .date-search-form {
        display: flex;
        align-items: flex-end;
        gap: 20px;
        background: #f4f8fb;
        border-radius: 8px;
        padding: 18px 24px 12px 24px;
        margin-bottom: 18px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        flex-wrap: wrap;
    }
    .date-search-fields {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
    }
    .date-field {
        display: flex;
        flex-direction: column;
        min-width: 120px;
    }
    .date-field label {
        font-size: 0.95em;
        color: #007bff;
        margin-bottom: 4px;
        font-weight: 500;
        letter-spacing: 0.02em;
    }
    .date-field input {
        padding: 7px 10px;
        border: 1px solid #bcdffb;
        border-radius: 4px;
        font-size: 1em;
        background: #fff;
        transition: border 0.2s;
    }
    .date-field input:focus {
        border: 1.5px solid #007bff;
        outline: none;
    }
    @media (max-width: 700px) {
        .date-search-form, .date-search-fields {
            flex-direction: column;
            gap: 10px;
            align-items: stretch;
        }
        .search-btn {
            margin-left: 0;
            width: 100%;
        }
    }
    .clear-btn {
        background: #ff4d4d;
        border: none;
        color: #111;
        font-size: 1.1em;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }
    .clear-btn:hover {
        background: #c40000;
        color: #000;
    }

    /* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
    .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        margin: 20px 0;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .pagination-info {
        font-size: 0.9em;
        color: #6c757d;
        margin: 0 15px;
    }

    .pagination-btn {
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 500;
        transition: all 0.2s ease;
        min-width: 80px;
    }

    .pagination-btn:hover:not(:disabled) {
        background: linear-gradient(45deg, #0056b3, #004085);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,123,255,0.3);
    }

    .pagination-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
    }

    .pagination-btn:disabled:hover {
        transform: none;
        box-shadow: none;
    }

    .page-number {
        background: white;
        color: #007bff;
        border: 2px solid #007bff;
        padding: 8px 12px;
        border-radius: 5px;
        font-weight: bold;
        min-width: 40px;
        text-align: center;
    }

    .page-number.current {
        background: #007bff;
        color: white;
    }

    @media (max-width: 600px) {
        .pagination-container {
            flex-direction: column;
            gap: 15px;
        }
        
        .pagination-info {
            margin: 0;
        }
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>{{ page_title }}</h1>
            <div class="header-row">
                <span>{{ current_time }}</span>
                <button class="refresh-btn" onclick="refreshData()">ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥</button>
            </div>
        </header>

        <!-- çµ±è¨ˆæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="stats-section">
            <div class="stats-info">
                <div class="stat-item">
                    <div class="stat-value" id="total-count">{{ data_count }}</div>
                    <div class="stat-label">ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="visible-count">{{ data_count }}</div>
                    <div class="stat-label">è¡¨ç¤ºä»¶æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ devices|length }}</div>
                    <div class="stat-label">æ©Ÿå™¨æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">{{ last_scan }}</div>
                    <div class="stat-label">æœ€çµ‚ã‚¹ã‚­ãƒ£ãƒ³</div>
                </div>
                <div class="stat-item oldest-item">
                    <div class="stat-value" id="oldest-date-value" style="cursor:pointer; text-decoration:underline;">
                        {% if oldest_date %}
                            <span onclick="setStartDateFromOldest('{{ oldest_date }}')">{{ oldest_date }}</span>
                        {% else %}
                            ãƒ‡ãƒ¼ã‚¿ãªã—
                        {% endif %}
                    </div>
                    <div class="stat-label">æœ€å¤ãƒ‡ãƒ¼ã‚¿<br><span class="oldest-desc">ï¼ˆã“ã‚ŒãŒè¨˜éŒ²ä¸Šã€æœ€ã‚‚å¤ã„ãƒ‡ãƒ¼ã‚¿ã®æ—¥ä»˜ã§ã™ï¼‰</span></div>
                </div>
            </div>
        </div>

        <main>
            <div class="controls-section">
                <form class="date-search-form" onsubmit="searchByDate(); return false;">
                    <div class="date-search-fields">
                        <div class="date-field">
                            <label for="start-date">é–‹å§‹æ—¥</label>
                            <div style="display:flex;align-items:center;gap:4px;">
                                <input type="text" id="start-date" name="start-date">
                                <button type="button" class="clear-btn" onclick="clearInput('start-date')" title="ã‚¯ãƒªã‚¢" style="margin-left:2px;">Ã—</button>
                            </div>
                        </div>
                        <div class="date-field">
                            <label for="end-date">çµ‚äº†æ—¥</label>
                            <div style="display:flex;align-items:center;gap:4px;">
                                <input type="text" id="end-date" name="end-date">
                                <button type="button" class="clear-btn" onclick="clearInput('end-date')" title="ã‚¯ãƒªã‚¢" style="margin-left:2px;">Ã—</button>
                            </div>
                        </div>
                        <div class="date-field">
                            <label for="start-time">é–‹å§‹æ™‚é–“</label>
                            <div style="display:flex;align-items:center;gap:4px;">
                                <input type="time" id="start-time" name="start-time">
                                <button type="button" class="clear-btn" onclick="clearInput('start-time')" title="ã‚¯ãƒªã‚¢" style="margin-left:2px;">Ã—</button>
                            </div>
                        </div>
                        <div class="date-field">
                            <label for="end-time">çµ‚äº†æ™‚é–“</label>
                            <div style="display:flex;align-items:center;gap:4px;">
                                <input type="time" id="end-time" name="end-time">
                                <button type="button" class="clear-btn" onclick="clearInput('end-time')" title="ã‚¯ãƒªã‚¢" style="margin-left:2px;">Ã—</button>
                            </div>
                        </div>
                    </div>
                    <button class="search-btn" type="submit">æ¤œç´¢</button>
                </form>
            </div>

            <div class="main-content-flex">
                <div class="table-container">
                    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸Šéƒ¨ï¼‰ -->
                    <div class="pagination-container" id="pagination-top">
                        <button class="pagination-btn" id="prev-btn-top" onclick="changePage(-1)" disabled>æˆ»ã‚‹</button>
                        <div class="pagination-info" id="pagination-info-top">
                            1-50 / 0ä»¶ä¸­
                        </div>
                        <button class="pagination-btn" id="next-btn-top" onclick="changePage(1)" disabled>æ¬¡ã¸</button>
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ©Ÿå™¨å</th>
                                <th>æ’®å½±æ—¥æ™‚</th>
                                <th>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</th>
                                <th>åˆ†é¡</th>
                                <th>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹</th>
                                <th>æ—¥ä»˜</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body">
                            {% for item in table_data %}
                            <tr data-device="{{ item.id }}" data-category="{{ item.category }}">
                                <td>{{ item.id }}</td>
                                <td>{{ item.datetime }}</td>
                                <td>{{ item.option }}</td>
                                <td class="category-cell type-{{ item.category }}">
                                    {{ item.category }}
                                </td>
                                <td class="file-path-cell" 
                                    onclick="playVideo('{{ item.full_path }}', '{{ item.file_path }}', '{{ item.id }}', '{{ item.datetime }}')"
                                    data-full-path="{{ item.file_path }}">
                                    {{ item.file_path }}
                                </td>
                                <td>{{ item.date }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸‹éƒ¨ï¼‰ -->
                    <div class="pagination-container" id="pagination-bottom">
                        <button class="pagination-btn" id="prev-btn-bottom" onclick="changePage(-1)" disabled>æˆ»ã‚‹</button>
                        <div class="pagination-info" id="pagination-info-bottom">
                            1-50 / 0ä»¶ä¸­
                        </div>
                        <button class="pagination-btn" id="next-btn-bottom" onclick="changePage(1)" disabled>æ¬¡ã¸</button>
                    </div>
                </div>
                <aside class="sidebar modern-sidebar">
                    <div class="filter-card">
                        <div class="category-filter">
                            <div class="filter-title">ã‚«ãƒ†ã‚´ãƒª</div>
                            <div class="category-options">
                                {% for category in categories %}
                                <label>
                                    <input type="checkbox" checked value="{{ category }}" onchange="applyFilters()"> {{ category }}
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="filter-card">
                        <div class="device-filter">
                            <div class="filter-title">æ©Ÿå™¨å</div>
                            <div class="device-options">
                                {% for device in devices %}
                                <label>
                                    <input type="checkbox" checked value="{{ device }}" onchange="applyFilters()"> {{ device }}
                                </label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- å‹•ç”»å†ç”Ÿãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰ -->
    <div id="videoModal" class="video-modal">
        <div class="video-modal-content">
            <div class="video-info" id="video-info">
                <strong>å‹•ç”»æƒ…å ±:</strong><br>
                <span id="video-device"></span> - <span id="video-datetime"></span><br>
                <span id="video-path"></span>
            </div>
            <div class="video-container">
                <video class="video-player" id="video-player" controls preload="metadata">
                    <source id="video-source" src="" type="video/mp4">
                    ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
                </video>
            </div>
            <div class="video-controls">
                <a class="video-download-btn" id="video-download" href="" download>å‹•ç”»ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                <button class="video-close-btn" onclick="closeVideoModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¡¨ç¤ºãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼‰ -->
    <div id="pathModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹</h3>
            <p id="modal-path" style="word-break: break-all; font-family: monospace; background-color: #f8f9fa; padding: 10px; border-radius: 4px;"></p>
            <button onclick="copyPath()" style="background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">ãƒ‘ã‚¹ã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
    </div>

    <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <script src="/static/js/utils.js"></script>
    <script>
    // åˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜ã®ä¸€è¦§ã‚’ä¿æŒã™ã‚‹å¤‰æ•°
    let availableDates = [];

    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®å¤‰æ•°
    let currentPage = 1;
    let totalPages = 1;
    let totalItems = 0;
    let itemsPerPage = 50;
    let currentSearchParams = {};

    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
    function updatePaginationInfo() {
        const startItem = (currentPage - 1) * itemsPerPage + 1;
        const endItem = Math.min(currentPage * itemsPerPage, totalItems);
        const infoText = `${startItem}-${endItem} / ${totalItems}ä»¶ä¸­`;
        
        document.getElementById('pagination-info-top').textContent = infoText;
        document.getElementById('pagination-info-bottom').textContent = infoText;
        
        // ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’è¨­å®š
        const prevButtons = ['prev-btn-top', 'prev-btn-bottom'];
        const nextButtons = ['next-btn-top', 'next-btn-bottom'];
        
        prevButtons.forEach(id => {
            document.getElementById(id).disabled = currentPage <= 1;
        });
        
        nextButtons.forEach(id => {
            document.getElementById(id).disabled = currentPage >= totalPages;
        });
    }

    // ãƒšãƒ¼ã‚¸ã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°
    async function changePage(delta) {
        const newPage = currentPage + delta;
        if (newPage >= 1 && newPage <= totalPages) {
            currentPage = newPage;
            await loadData();
        }
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
    async function loadData(updateTotalCount = false) {
        try {
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
            
            // æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰
            const params = new URLSearchParams();
            if (currentSearchParams.startDate) params.append('start_date', currentSearchParams.startDate);
            if (currentSearchParams.endDate) params.append('end_date', currentSearchParams.endDate);
            if (currentSearchParams.startTime) params.append('start_time', currentSearchParams.startTime);
            if (currentSearchParams.endTime) params.append('end_time', currentSearchParams.endTime);
            params.append('page', currentPage);
            params.append('per_page', itemsPerPage);

            // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã‚’å–å¾—
            const selectedCategories = Array.from(document.querySelectorAll('.category-options input:checked'))
                .map(input => input.value);
            const selectedDevices = Array.from(document.querySelectorAll('.device-options input:checked'))
                .map(input => input.value);

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«è¿½åŠ 
            if (selectedCategories.length > 0) {
                params.append('category', selectedCategories.join(','));
            }
            if (selectedDevices.length > 0) {
                params.append('device', selectedDevices.join(','));
            }

            // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            const response = await fetch(`/api/search?${params.toString()}`);
            const data = await response.json();

            if (data.status === 'success') {
                // ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†…å®¹ã‚’æ›´æ–°
                const tbody = document.getElementById('data-table-body');
                tbody.innerHTML = '';

                if (data.results.length === 0) {
                    showNotification('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'info');
                    return;
                }

                data.results.forEach(item => {
                    const row = document.createElement('tr');
                    row.dataset.device = item.id;
                    row.dataset.category = item.category;
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.datetime}</td>
                        <td>${item.option}</td>
                        <td class="category-cell type-${item.category}">${item.category}</td>
                        <td class="file-path-cell" 
                            onclick="playVideo('${item.full_path}', '${item.file_path}', '${item.id}', '${item.datetime}')"
                            data-full-path="${item.file_path}">${item.file_path}</td>
                        <td>${item.date}</td>
                    `;
                    tbody.appendChild(row);
                });

                // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°
                totalItems = data.total;
                totalPages = data.total_pages;
                updatePaginationInfo();

                // æ©Ÿå™¨åã®è‰²ã‚’å†é©ç”¨
                generateDeviceColors();

                // ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã®æ›´æ–°ï¼ˆupdateTotalCountãŒtrueã®ã¨ãã®ã¿ï¼‰
                if (updateTotalCount) {
                    document.getElementById('total-count').textContent = data.total;
                }
                // è¡¨ç¤ºä»¶æ•°ã®æ›´æ–°
                document.getElementById('visible-count').textContent = data.count;
                
                showNotification(`${data.count}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
            } else {
                showNotification('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        } catch (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            showNotification('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
    }

    // åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
    async function loadInitialData() {
        currentPage = 1;
        currentSearchParams = {};
        
        // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æ™‚ã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
        try {
            showNotification('åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
            
            const params = new URLSearchParams();
            params.append('page', currentPage);
            params.append('per_page', itemsPerPage);

            const response = await fetch(`/api/search?${params.toString()}`);
            const data = await response.json();

            if (data.status === 'success') {
                // ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†…å®¹ã‚’æ›´æ–°
                const tbody = document.getElementById('data-table-body');
                tbody.innerHTML = '';

                if (data.results.length === 0) {
                    showNotification('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'info');
                    return;
                }

                data.results.forEach(item => {
                    const row = document.createElement('tr');
                    row.dataset.device = item.id;
                    row.dataset.category = item.category;
                    row.innerHTML = `
                        <td>${item.id}</td>
                        <td>${item.datetime}</td>
                        <td>${item.option}</td>
                        <td class="category-cell type-${item.category}">${item.category}</td>
                        <td class="file-path-cell" 
                            onclick="playVideo('${item.full_path}', '${item.file_path}', '${item.id}', '${item.datetime}')"
                            data-full-path="${item.file_path}">${item.file_path}</td>
                        <td>${item.date}</td>
                    `;
                    tbody.appendChild(row);
                });

                // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°
                totalItems = data.total;
                totalPages = data.total_pages;
                updatePaginationInfo();

                // æ©Ÿå™¨åã®è‰²ã‚’å†é©ç”¨
                generateDeviceColors();

                // ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã®æ›´æ–°ï¼ˆåˆæœŸãƒ­ãƒ¼ãƒ‰ã¯å¿…ãšæ›´æ–°ï¼‰
                document.getElementById('total-count').textContent = data.total;
                // è¡¨ç¤ºä»¶æ•°ã®æ›´æ–°
                document.getElementById('visible-count').textContent = data.count;
                
                showNotification(`${data.count}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
            } else {
                showNotification('åˆæœŸãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        } catch (error) {
            console.error('åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            showNotification('åˆæœŸãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
    }

    // åˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜ã‚’ 'YYYY-MM-DD' å½¢å¼ã«å¤‰æ›
    function toDashDate(dateStr) {
        return dateStr.replace(/\//g, '-');
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã§YYYY-MM-DDæ–‡å­—åˆ—ã‚’è¿”ã™é–¢æ•°
    function getLocalDateString(dateObj) {
        const year = dateObj.getFullYear();
        const month = ('0' + (dateObj.getMonth() + 1)).slice(-2);
        const day = ('0' + dateObj.getDate()).slice(-2);
        return `${year}-${month}-${day}`;
    }

    function setupFlatpickr() {
        const enableDates = availableDates.map(toDashDate);

        // é–‹å§‹æ—¥ï¼šå‹•ç”»ãŒã‚ã‚‹æ—¥ã ã‘é¸æŠå¯ãƒ»èµ¤æ–‡å­—
        flatpickr("#start-date", {
            dateFormat: "Y-m-d",
            enable: enableDates,
            locale: "ja",
            onDayCreate: function(dObj, dStr, fp, dayElem) {
                const dateStr = getLocalDateString(dayElem.dateObj);
                if (enableDates.includes(dateStr)) {
                    dayElem.style.color = '#dc3545';
                    dayElem.style.fontWeight = 'bold';
                }
            }
        });

        // çµ‚äº†æ—¥ï¼šå…¨æ—¥é¸æŠå¯ã€å‹•ç”»ãŒã‚ã‚‹æ—¥ã¯èµ¤ã€ãªã„æ—¥ã¯é»’
        flatpickr("#end-date", {
            dateFormat: "Y-m-d",
            locale: "ja",
            onDayCreate: function(dObj, dStr, fp, dayElem) {
                const dateStr = getLocalDateString(dayElem.dateObj);
                if (enableDates.includes(dateStr)) {
                    dayElem.style.color = '#dc3545';
                    dayElem.style.fontWeight = 'bold';
                } else {
                    dayElem.style.color = '#222';
                    dayElem.style.fontWeight = 'normal';
                }
            }
        });
    }

    // åˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜ã‚’å–å¾—ã™ã‚‹é–¢æ•°
    async function fetchAvailableDates() {
        try {
            const response = await fetch('/api/available-dates');
            const data = await response.json();
            if (data.status === 'success') {
                availableDates = data.dates;
                setupFlatpickr();
            }
        } catch (error) {
            console.error('æ—¥ä»˜ä¸€è¦§ã®å–å¾—ã«å¤±æ•—:', error);
            showNotification('æ—¥ä»˜ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    }

    // æ©Ÿå™¨åã”ã¨ã®è‰²ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
    function generateDeviceColors() {
        const devices = Array.from(new Set(Array.from(document.querySelectorAll('tr[data-device]')).map(tr => tr.dataset.device)));
        const colors = {};
        
        // 10è‰²ã®ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
        const colorPalette = [
            '#FFE4E1', // ãƒŸã‚¹ãƒˆãƒ­ãƒ¼ã‚º
            '#E0FFFF', // ãƒ©ã‚¤ãƒˆã‚·ã‚¢ãƒ³
            '#F0FFF0', // ãƒãƒ‹ãƒ¼ãƒ‡ãƒ¥ãƒ¼
            '#FFF0F5', // ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ–ãƒ©ãƒƒã‚·ãƒ¥
            '#F5F5DC', // ãƒ™ãƒ¼ã‚¸ãƒ¥
            '#E6E6FA', // ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼
            '#F0F8FF', // ã‚¢ãƒªã‚¹ãƒ–ãƒ«ãƒ¼
            '#FFFACD', // ãƒ¬ãƒ¢ãƒ³ãƒãƒ•
            '#E0F0FF', // ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼
            '#FFE4B5'  // ãƒ¢ã‚«ã‚·ãƒ³
        ];

        // æ©Ÿå™¨åã”ã¨ã«è‰²ã‚’å‰²ã‚Šå½“ã¦
        devices.forEach((device, index) => {
            colors[device] = colorPalette[index % colorPalette.length];
        });

        // å„è¡Œã«è‰²ã‚’é©ç”¨
        document.querySelectorAll('tr[data-device]').forEach(tr => {
            const device = tr.dataset.device;
            tr.style.backgroundColor = colors[device];
            tr.classList.add('device-row');
        });
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã™ã‚‹é–¢æ•°
    async function refreshData() {
        try {
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä¸­...', 'info');
            
            // ç¾åœ¨ã®æ¤œç´¢æ¡ä»¶ã‚’ä¿æŒã—ãŸã¾ã¾ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
            await loadData();
            
            showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¾ã—ãŸ', 'success');
        } catch (error) {
            console.error('ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¨ãƒ©ãƒ¼:', error);
            showNotification('ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’é©ç”¨ã™ã‚‹é–¢æ•°
    async function applyFilters() {
        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨æ™‚ã¯ãƒšãƒ¼ã‚¸ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
        currentPage = 1;
        
        // ç¾åœ¨ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶ã‚’ä¿å­˜ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
        // ã“ã“ã§ã¯å˜ç´”ã«ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
        await loadData(false); // ã‚«ãƒ†ã‚´ãƒªãƒ»æ©Ÿå™¨åãƒ•ã‚£ãƒ«ã‚¿æ™‚ã¯ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’æ›´æ–°ã—ãªã„
    }

    // å‹•ç”»ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
    function playVideo(fullPath, filePath, device, datetime) {
        try {
            showNotification('å‹•ç”»ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
            const encodedPath = encodeURIComponent(filePath);
            const videoUrl = `/api/video?path=${encodedPath}`;
            
            const modal = document.getElementById('videoModal');
            const videoPlayer = document.getElementById('video-player');
            const videoSource = document.getElementById('video-source');
            const videoDownload = document.getElementById('video-download');
            
            // å‹•ç”»æƒ…å ±ã‚’è¨­å®š
            document.getElementById('video-device').textContent = `æ©Ÿå™¨: ${device}`;
            document.getElementById('video-datetime').textContent = `æ—¥æ™‚: ${datetime}`;
            document.getElementById('video-path').textContent = `ãƒ‘ã‚¹: ${filePath}`;
            
            // å‹•ç”»ã‚½ãƒ¼ã‚¹ã‚’è¨­å®š
            videoSource.src = videoUrl;
            videoPlayer.load();
            
            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’è¨­å®š
            videoDownload.href = videoUrl;
            videoDownload.download = filePath.split('/').pop();
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            modal.style.display = 'block';
            
            // å‹•ç”»ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
            videoPlayer.oncanplay = function() {
                showNotification('å‹•ç”»ã®æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
            };
            
            videoPlayer.onerror = function(e) {
                console.error('å‹•ç”»ã‚¨ãƒ©ãƒ¼:', e);
                showNotification('å‹•ç”»ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            };
            
            videoPlayer.play().catch(error => {
                console.error('å‹•ç”»å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);
                showNotification('å‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            });
        } catch (error) {
            console.error('å‹•ç”»å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);
            showNotification('å‹•ç”»ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
    }

    // å‹•ç”»ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
    function closeVideoModal() {
        const modal = document.getElementById('videoModal');
        const videoPlayer = document.getElementById('video-player');
        
        videoPlayer.pause();
        videoPlayer.currentTime = 0;
        modal.style.display = 'none';
    }

    // ãƒ‘ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹é–¢æ•°
    function copyPath() {
        const pathText = document.getElementById('modal-path').textContent;
        navigator.clipboard.writeText(pathText).then(() => {
            showNotification('ãƒ‘ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            closeModal();
        }).catch(error => {
            console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
            showNotification('ãƒ‘ã‚¹ã®ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        });
    }

    // æ—¥ä»˜æ¤œç´¢ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
    async function searchByDate() {
        try {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;

            // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
            console.log('æ¤œç´¢æ¡ä»¶:', {
                startDate,
                endDate,
                startTime,
                endTime
            });

            // æ—¥ä»˜ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„å ´åˆã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            if (!startDate && !endDate) {
                showNotification('æ—¥ä»˜ã‚’æŒ‡å®šã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            // æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¿å­˜
            currentSearchParams = {
                startDate,
                endDate,
                startTime,
                endTime
            };

            // ãƒšãƒ¼ã‚¸ã‚’1ã«ãƒªã‚»ãƒƒãƒˆ
            currentPage = 1;

            showNotification('æ¤œç´¢ä¸­...', 'info');

            // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ï¼ˆæ—¥ä»˜ãƒ»æ™‚é–“æ¤œç´¢æ™‚ã¯ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚‚æ›´æ–°ï¼‰
            await loadData(true);

        } catch (error) {
            console.error('æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
            showNotification('æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        }
    }

    // é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function showNotification(message, type = 'info') {
        // æ—¢å­˜ã®é€šçŸ¥ã‚’å‰Šé™¤
        const existingNotification = document.querySelector('.notification');
        if (existingNotification) {
            existingNotification.remove();
        }

        // é€šçŸ¥è¦ç´ ã®ä½œæˆ
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;

        // ã‚¹ã‚¿ã‚¤ãƒ«ã®è¨­å®š
        notification.style.position = 'fixed';
        notification.style.top = '20px';
        notification.style.right = '20px';
        notification.style.padding = '10px 20px';
        notification.style.borderRadius = '4px';
        notification.style.zIndex = '1000';
        notification.style.animation = 'slideIn 0.3s ease-out';

        // ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸè‰²ã®è¨­å®š
        switch (type) {
            case 'success':
                notification.style.backgroundColor = '#d4edda';
                notification.style.color = '#155724';
                notification.style.border = '1px solid #c3e6cb';
                break;
            case 'error':
                notification.style.backgroundColor = '#f8d7da';
                notification.style.color = '#721c24';
                notification.style.border = '1px solid #f5c6cb';
                break;
            case 'warning':
                notification.style.backgroundColor = '#fff3cd';
                notification.style.color = '#856404';
                notification.style.border = '1px solid #ffeeba';
                break;
            default:
                notification.style.backgroundColor = '#d1ecf1';
                notification.style.color = '#0c5460';
                notification.style.border = '1px solid #bee5eb';
        }

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes fadeOut {
                from {
                    opacity: 1;
                }
                to {
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // é€šçŸ¥ã‚’è¡¨ç¤º
        document.body.appendChild(notification);

        // 3ç§’å¾Œã«é€šçŸ¥ã‚’æ¶ˆã™
        setTimeout(() => {
            notification.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 300);
        }, 3000);
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', async () => {
        generateDeviceColors();
        fetchAvailableDates(); // åˆ©ç”¨å¯èƒ½ãªæ—¥ä»˜ã‚’å–å¾—
        
        // åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        await loadInitialData();
    });

    // ã€Œæœ€å¤ãƒ‡ãƒ¼ã‚¿ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‹å§‹æ—¥ã«è‡ªå‹•å…¥åŠ›
    function setStartDateFromOldest(jpDate) {
        // jpDate: 'YYYYå¹´MMæœˆDDæ—¥' â†’ 'YYYY-MM-DD' ã¸å¤‰æ›
        const m = jpDate.match(/(\d{4})å¹´(\d{2})æœˆ(\d{2})æ—¥/);
        if (!m) return;
        const ymd = `${m[1]}-${m[2]}-${m[3]}`;
        const startInput = document.getElementById('start-date');
        if (startInput) {
            startInput.value = ymd;
            // flatpickrãŒä½¿ã‚ã‚Œã¦ã„ã‚Œã°setDateã‚‚å‘¼ã¶
            if (startInput._flatpickr) {
                startInput._flatpickr.setDate(ymd, true);
            }
        }
        showNotification('é–‹å§‹æ—¥ã«æœ€å¤ãƒ‡ãƒ¼ã‚¿ã®æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
    }

    function clearInput(id) {
        const input = document.getElementById(id);
        if (input) {
            input.value = '';
            // flatpickrå¯¾å¿œ
            if (input._flatpickr) {
                input._flatpickr.clear();
            }
        }
    }
    </script>
</body>
</html>